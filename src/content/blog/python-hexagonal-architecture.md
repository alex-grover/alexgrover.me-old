---
title: Hexagonal Architecture in Python using Flask and SqlAlchemy
pubDate: 2019-11-15T12:00:00.000Z
description: A discussion about architecture conventions for Python backends.
---

The source code for the project described in this post is available [on Github](https://github.com/alex-grover/hexagonal-architecture-python). It's a basic JSON API that could power a blog, storing posts and associated metadata in a Postgres database.

## About me

Hey, I'm Alex. I've been a software engineer for about 5 years now at a few tech companies of various sizes. I'm a full-stack engineer, but my primary experience is backend development with Python and Django. I'm passionate about writing high-quality, maintainable code, and I enjoy learning about software architecture and comparing and contrasting different ways to write programs. Today, I'd like to challenge some common practices in the Python community and propose an alternative.

## The problem with typical Python architectures

Python is a language that's known for several good backend web frameworks - Django and Flask being the most popular among them. Django is complex and full-featured, with a builtin admin interface, request routing, an ORM, a template engine, and much more. Flask is significantly more lightweight but is often paired with other libraries (notably the SqlAlchemy ORM) to provide a similar experience.

After 3 years working on a large Django app with a team of engineers that grew from 10 to 200+, I've seen firsthand just how crazy things can get. 1000-line methods, slow API endpoints that are nearly impossible to profile and improve, and a test suite that takes over a minute just to start up and run a single test. These issues aren't necessarily caused by the framework itself, but your choice of technology certainly guides the outcome of your codebase and I've found that many of these web frameworks often point you in the wrong direction right out of the gate.

In particular, some things that I think they get wrong:

- ORMs don't adequately separate data and behavior. They make it too easy to access the database from anywhere in your codebase - with simple "dot" access, you can issue a complex query that slows down your whole application and you might not even realize it! All of a sudden, your view code, your model code, and even helper functions are making database calls that eventually cause a bottleneck.
- Most frameworks don't give you good guidance as to where the bulk of your code should actually _go_. Once you have a non-trivial app, your views start to get really big. There are different schools of thought on how to grow your application (see: Fat Models and Service Objects) but the Python community doesn't seem to discuss them often, and the frameworks themselves don't mention much about architecture at all in their documentation.
- Some generally bad conventions. One that comes to mind is overriding ORM methods and hooks in Django. When calling `save()` on an object can potentially mutate it or have side effects on other models, and you can also have a post_save hook with even more behavior that no one could figure out where else to put, it's easy to write confusing, messy code. Obviously, no one sets out to write something poorly, but when you're working with a large team it's easy to add a couple lines of code in a place that seems right and realize later that it's really hard to understand.

## Enter Hexagonal Architecture

<svg viewBox="0 0 960 720" fill="none" stroke-linecap="square" stroke-miterlimit="10" xmlns="http://www.w3.org/2000/svg">
  <clipPath id="a">
    <path d="M0 0h960v720H0V0z"/>
  </clipPath>
  <g clip-path="url(#a)">
    <path fill="none" d="M0 0h960v720H0z"/>
    <path
      fill="#93c47d"
      d="m223.546 346.113 101.968-203.937h266.867l101.968 203.937L592.381 550.05H325.514z"
      fill-rule="evenodd"
    />
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="m223.546 346.113 101.968-203.937h266.867l101.968 203.937L592.381 550.05H325.514z"
    />
    <path
      fill="#ffd966"
      d="M319.625 346.113 379.97 225.42h157.953l60.346 120.693-60.346 120.693H379.97z"
      fill-rule="evenodd"
    />
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="M319.625 346.113 379.97 225.42h157.953l60.346 120.693-60.346 120.693H379.97z"
    />
    <path
      fill="#000"
      d="M407.26 357.833v-22.75h6.36q2.796 0 5.015 1.281 2.219 1.266 3.453 3.64 1.25 2.376 1.25 5.407v2.094q0 3.047-1.234 5.406-1.235 2.36-3.485 3.64-2.234 1.282-5.14 1.282h-6.219zm1.922-21.11v19.485h4.312q3.594 0 5.766-2.375 2.172-2.39 2.172-6.453v-2q0-3.922-2.14-6.282-2.141-2.359-5.641-2.375h-4.47zm17.562 12.407q0-2.438.938-4.39.953-1.954 2.672-3.032 1.734-1.094 3.922-1.094 3.375 0 5.468 2.375 2.094 2.36 2.094 6.266v.39q0 2.453-.953 4.422-.938 1.953-2.656 3.016-1.719 1.062-3.922 1.062-3.36 0-5.469-2.359-2.094-2.375-2.094-6.281v-.375zm1.875.515q0 3.032 1.563 4.985 1.578 1.937 4.125 1.937 2.531 0 4.094-1.937 1.578-1.953 1.578-5.14v-.36q0-1.938-.719-3.547-.719-1.61-2.016-2.485-1.297-.89-2.968-.89-2.5 0-4.079 1.969-1.578 1.953-1.578 5.125v.343zm18.782-8.718.062 2.75q.938-1.532 2.344-2.297 1.406-.766 3.125-.766 4 0 5.078 3.281.906-1.578 2.422-2.422 1.515-.859 3.344-.859 5.437 0 5.546 5.938v11.28h-1.875v-11.14q-.015-2.265-.984-3.36-.953-1.093-3.125-1.093-2.016.031-3.406 1.313-1.39 1.265-1.547 3.093v11.188h-1.875v-11.281q-.016-2.172-1.031-3.235-1-1.078-3.094-1.078-1.766 0-3.031 1.016-1.266 1-1.875 2.984v11.594h-1.875v-16.906h1.797zm37.328 16.906q-.281-.797-.36-2.36-.984 1.282-2.515 1.985-1.516.687-3.219.687-2.438 0-3.953-1.359-1.5-1.36-1.5-3.438 0-2.468 2.047-3.906 2.062-1.437 5.734-1.437h3.39v-1.922q0-1.813-1.124-2.844-1.11-1.047-3.25-1.047-1.953 0-3.235 1-1.28 1-1.28 2.406l-1.876-.015q0-2.016 1.875-3.485 1.875-1.484 4.61-1.484 2.828 0 4.453 1.422 1.64 1.406 1.687 3.937v8q0 2.454.516 3.672v.188h-2zm-5.875-1.344q1.875 0 3.344-.906 1.484-.906 2.156-2.422v-3.719h-3.344q-2.797.031-4.375 1.031-1.578.985-1.578 2.72 0 1.421 1.047 2.359 1.062.937 2.75.937zm14.437 1.344h-1.875v-16.906h1.875v16.906zm-2.203-21.797q0-.531.344-.89.344-.376.937-.376.594 0 .938.375.36.36.36.891t-.36.89q-.344.36-.938.36-.593 0-.937-.36-.344-.359-.344-.89zm9.063 4.89.062 2.891q.953-1.562 2.375-2.375 1.422-.828 3.14-.828 2.72 0 4.048 1.531 1.328 1.532 1.343 4.594v11.094h-1.859v-11.11q-.016-2.265-.969-3.375-.937-1.109-3.015-1.109-1.735 0-3.079 1.094-1.328 1.078-1.968 2.922v11.578h-1.86v-16.906h1.782z"
    />
    <path fill="none" d="m325.514 142.176 54.457 83.244"/>
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="m325.514 142.176 54.457 83.244"
    />
    <path fill="none" d="M223.546 346.113h96.094"/>
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="M223.546 346.113h96.094"
    />
    <path fill="none" d="m325.514 550.05 54.457-83.244"/>
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="m325.514 550.05 54.457-83.244"
    />
    <path fill="none" d="m537.924 466.806 54.457 83.244"/>
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="m537.924 466.806 54.457 83.244"
    />
    <path fill="none" d="M598.27 346.113h96.095"/>
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="M598.27 346.113h96.095"
    />
    <path fill="none" d="m537.924 225.42 54.457-83.244"/>
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="m537.924 225.42 54.457-83.244"
    />
    <path
      fill="#cfe2f3"
      d="M717.528 134.102c0 5.458 17.697 9.882 39.527 9.882 21.83 0 39.528-4.424 39.528-9.882v85.402c0 5.458-17.697 9.882-39.528 9.882-21.83 0-39.527-4.424-39.527-9.882z"
      fill-rule="evenodd"
    />
    <path
      fill="#e2edf7"
      d="M717.528 134.102c0-5.457 17.697-9.882 39.527-9.882 21.83 0 39.528 4.425 39.528 9.882 0 5.458-17.697 9.882-39.528 9.882-21.83 0-39.527-4.424-39.527-9.882z"
      fill-rule="evenodd"
    />
    <path
      fill="none"
      d="M796.583 134.102c0 5.458-17.697 9.882-39.528 9.882-21.83 0-39.527-4.424-39.527-9.882 0-5.457 17.697-9.882 39.527-9.882 21.83 0 39.528 4.425 39.528 9.882v85.402c0 5.458-17.697 9.882-39.528 9.882-21.83 0-39.527-4.424-39.527-9.882v-85.402"
    />
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="M796.583 134.102c0 5.458-17.697 9.882-39.528 9.882-21.83 0-39.527-4.424-39.527-9.882 0-5.457 17.697-9.882 39.527-9.882 21.83 0 39.528 4.425 39.528 9.882v85.402c0 5.458-17.697 9.882-39.528 9.882-21.83 0-39.527-4.424-39.527-9.882v-85.402"
    />
    <path
      fill="#000"
      d="M746.903 188.664v-13.266h3.719q1.625 0 2.906.75 1.297.735 2.016 2.125.734 1.375.734 3.157v1.218q0 1.766-.719 3.141t-2.031 2.125q-1.297.75-3 .75h-3.625zm1.125-12.312v11.359h2.516q2.093 0 3.359-1.375 1.266-1.39 1.266-3.766v-1.172q0-2.28-1.25-3.656-1.25-1.375-3.282-1.39h-2.61zm11.09 12.312v-13.266h3.923q2.125 0 3.218.891 1.11.875 1.11 2.578 0 1.031-.563 1.797-.547.766-1.531 1.078 1.156.266 1.86 1.156.718.875.718 2.032 0 1.75-1.14 2.75-1.126.984-3.157.984h-4.437zm1.126-6.375v5.422h3.36q1.437 0 2.28-.719.844-.734.844-2.047 0-1.234-.812-1.937-.797-.719-2.22-.719h-3.452zm0-.937h3.062q1.406-.032 2.172-.657.766-.64.766-1.843 0-1.282-.797-1.891-.797-.61-2.406-.61h-2.797v5z"
    />
    <path
      fill="#cfe2f3"
      d="M717.727 493.517c-1.42-10.923 3.241-21.737 12.004-27.852 8.763-6.115 20.091-6.459 29.178-.886 3.219-6.351 9.11-10.736 15.892-11.829s13.658 1.236 18.548 6.28c2.742-5.758 8.126-9.627 14.241-10.233 6.116-.607 12.097 2.135 15.822 7.252 4.954-6.104 12.836-8.674 20.235-6.598 7.4 2.076 12.987 8.425 14.345 16.3 6.07 1.734 11.125 6.14 13.86 12.082a23.815 23.815 0 0 1 .405 18.9c5.977 8.145 7.375 18.999 3.672 28.51-3.702 9.511-11.948 16.251-21.66 17.705-.07 8.927-4.744 17.118-12.224 21.416-7.48 4.298-16.597 4.032-23.837-.695-3.083 10.691-11.763 18.558-22.288 20.2-10.525 1.644-21.01-3.23-26.923-12.517-7.25 4.577-15.948 5.896-24.133 3.658-8.185-2.238-15.168-7.843-19.374-15.552-7.407.908-14.57-3.11-17.932-10.062-3.362-6.95-2.208-15.354 2.889-21.039-6.608-4.072-9.98-12.154-8.357-20.03 1.622-7.875 7.872-13.761 15.489-14.588z"
      fill-rule="evenodd"
    />
    <path
      fill="none"
      d="M710.449 528.556c3.118 1.922 6.72 2.794 10.323 2.499m4.719 28.603c1.549-.19 3.068-.592 4.516-1.195m38.988 13.088a29.415 29.415 0 0 1-2.722-5.454m51.935-2.229c.563-1.949.927-3.955 1.087-5.985m34.972-14.735c.073-9.504-5.082-18.205-13.25-22.368m31.238-23.846a22.761 22.761 0 0 1-5.9 8.387m-8.363-39.37c.225 1.307.33 2.634.311 3.961m-34.89-13.662a20.833 20.833 0 0 0-3.023 5.051m-27.041-2.07a19.234 19.234 0 0 0-1.464 4.356m-32.977 1.192a27.693 27.693 0 0 1 5.298 4.227m-46.479 24.511c.196 1.506.505 2.993.925 4.447"
    />
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="M717.727 493.517c-1.42-10.923 3.241-21.737 12.004-27.852 8.763-6.115 20.091-6.459 29.178-.886 3.219-6.351 9.11-10.736 15.892-11.829s13.658 1.236 18.548 6.28c2.742-5.758 8.126-9.627 14.241-10.233 6.116-.607 12.097 2.135 15.822 7.252 4.954-6.104 12.836-8.674 20.235-6.598 7.4 2.076 12.987 8.425 14.345 16.3 6.07 1.734 11.125 6.14 13.86 12.082a23.815 23.815 0 0 1 .405 18.9c5.977 8.145 7.375 18.999 3.672 28.51-3.702 9.511-11.948 16.251-21.66 17.705-.07 8.927-4.744 17.118-12.224 21.416-7.48 4.298-16.597 4.032-23.837-.695-3.083 10.691-11.763 18.558-22.288 20.2-10.525 1.644-21.01-3.23-26.923-12.517-7.25 4.577-15.948 5.896-24.133 3.658-8.185-2.238-15.168-7.843-19.374-15.552-7.407.908-14.57-3.11-17.932-10.062-3.362-6.95-2.208-15.354 2.889-21.039-6.608-4.072-9.98-12.154-8.357-20.03 1.622-7.875 7.872-13.761 15.489-14.588z"
    />
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="M710.449 528.556c3.118 1.922 6.72 2.794 10.323 2.499m4.719 28.603c1.549-.19 3.068-.592 4.516-1.195m38.988 13.088a29.415 29.415 0 0 1-2.722-5.454m51.935-2.229c.563-1.949.927-3.955 1.087-5.985m34.972-14.735c.073-9.504-5.082-18.205-13.25-22.368m31.238-23.846a22.761 22.761 0 0 1-5.9 8.387m-8.363-39.37c.225 1.307.33 2.634.311 3.961m-34.89-13.662a20.833 20.833 0 0 0-3.023 5.051m-27.041-2.07a19.234 19.234 0 0 0-1.464 4.356m-32.977 1.192a27.693 27.693 0 0 1 5.298 4.227m-46.479 24.511c.196 1.506.505 2.993.925 4.447"
    />
    <path
      fill="#000"
      d="M745.414 503.557v5.406h-1.125v-13.266h4.516q2.078 0 3.265 1.063 1.203 1.047 1.203 2.906 0 1.86-1.156 2.875-1.14 1.016-3.328 1.016h-3.375zm0-.938h3.39q1.641 0 2.485-.765.86-.782.86-2.172 0-1.375-.86-2.188-.844-.812-2.406-.843h-3.469v5.968zm16.23 6.344q-.156-.469-.203-1.375-.578.75-1.468 1.156-.89.407-1.875.407-1.422 0-2.313-.797-.875-.797-.875-2 0-1.438 1.203-2.282 1.203-.843 3.344-.843h1.969v-1.11q0-1.062-.656-1.672-.641-.609-1.891-.609-1.14 0-1.89.594-.75.578-.75 1.406l-1.094-.016q0-1.171 1.093-2.03 1.094-.86 2.688-.86 1.656 0 2.61.828.952.812.984 2.281v4.672q0 1.438.296 2.14v.11h-1.171zm-3.421-.781q1.093 0 1.953-.531.86-.532 1.25-1.407v-2.172h-1.953q-1.625.016-2.547.594-.922.578-.922 1.594 0 .828.61 1.375.624.547 1.609.547zm10.184-.781 2.875-8.297h1.172l-4.203 11.53-.219.517q-.812 1.796-2.5 1.796-.39 0-.844-.125l-.015-.906.578.047q.797 0 1.281-.39.5-.391.86-1.36l.484-1.328-3.719-9.781h1.188l3.062 8.297zm6.723-8.297.047 1.609q.547-.89 1.36-1.328.828-.453 1.828-.453 2.328 0 2.953 1.906.53-.922 1.406-1.406.89-.5 1.953-.5 3.172 0 3.234 3.453v6.578h-1.093v-6.5q0-1.312-.563-1.953-.562-.64-1.828-.64-1.172.015-1.984.765-.813.734-.907 1.812v6.516h-1.093v-6.578q0-1.266-.594-1.89-.578-.626-1.813-.626-1.015 0-1.765.594-.735.578-1.094 1.734v6.766h-1.094v-9.86h1.047zm19.362 10.047q-1.25 0-2.266-.625-1.015-.625-1.593-1.72-.563-1.109-.563-2.484v-.39q0-1.422.547-2.563.563-1.14 1.547-1.781.984-.656 2.125-.656 1.797 0 2.844 1.219 1.062 1.218 1.062 3.343v.61h-7.031v.218q0 1.672.953 2.797.969 1.11 2.422 1.11.875 0 1.547-.313.672-.328 1.219-1.031l.687.516q-1.203 1.75-3.5 1.75zm-.203-9.297q-1.219 0-2.063.906-.843.89-1.03 2.422h5.921v-.125q-.047-1.422-.812-2.313-.766-.89-2.016-.89zm7.06-.75.047 1.687q.546-.906 1.375-1.375.828-.484 1.843-.484 1.578 0 2.344.89.781.891.797 2.672v6.469h-1.094v-6.484q0-1.313-.562-1.953-.547-.657-1.75-.657-1.016 0-1.797.64-.781.626-1.156 1.704v6.75h-1.079v-9.86h1.032zm10.904-2.516v2.516h2.047v.89h-2.047v6.578q0 .813.297 1.22.297.39 1 .39.266 0 .875-.078l.047.89q-.422.157-1.172.157-1.11 0-1.625-.657-.516-.656-.516-1.922v-6.578h-1.812v-.89h1.812v-2.516h1.094zm10.213 9.875q0-.812-.656-1.297-.657-.5-1.97-.781-1.312-.281-2.03-.64-.72-.36-1.079-.876-.343-.515-.343-1.25 0-1.172.968-1.922.985-.765 2.5-.765 1.657 0 2.641.812 1 .813 1 2.125h-1.094q0-.875-.718-1.437-.72-.578-1.829-.578-1.078 0-1.734.484-.64.469-.64 1.234 0 .735.53 1.141.548.406 1.985.75 1.438.328 2.14.719.72.375 1.063.922.36.53.36 1.297 0 1.25-1.016 2-1 .75-2.625.75-1.719 0-2.797-.829-1.062-.843-1.062-2.125h1.093q.063.97.797 1.5.75.532 1.969.532 1.14 0 1.844-.5.703-.5.703-1.266zM744.95 525.557v5.406h-1.126v-13.266h4.516q2.078 0 3.266 1.063 1.203 1.047 1.203 2.906 0 1.86-1.156 2.875-1.141 1.016-3.329 1.016h-3.375zm0-.938h3.39q1.64 0 2.484-.765.86-.782.86-2.172 0-1.375-.86-2.188-.843-.812-2.406-.843h-3.469v5.968zm14.658-2.578q-.343-.062-.734-.062-1.016 0-1.719.562-.703.563-1.015 1.656v6.766h-1.078v-9.86h1.062l.016 1.563q.875-1.734 2.78-1.734.454 0 .72.11l-.032 1zm.938 3.844q0-1.422.547-2.547.563-1.14 1.563-1.766 1.015-.64 2.28-.64 1.97 0 3.188 1.375 1.235 1.375 1.235 3.656v.234q0 1.422-.563 2.563-.547 1.14-1.547 1.766-1 .625-2.28.625-1.97 0-3.204-1.375-1.219-1.391-1.219-3.672v-.22zm1.094.312q0 1.766.922 2.907.922 1.125 2.406 1.125 1.469 0 2.375-1.125.922-1.141.922-3v-.22q0-1.124-.422-2.062-.406-.937-1.172-1.453-.75-.515-1.734-.515-1.453 0-2.375 1.14-.922 1.14-.922 3v.203zm13.605 4.032q1.14 0 1.906-.641.781-.64.844-1.672h1.047q-.047.906-.578 1.656-.516.735-1.375 1.157-.86.422-1.844.422-1.938 0-3.078-1.344-1.125-1.36-1.125-3.64v-.329q0-1.453.5-2.562.515-1.125 1.468-1.735.954-.61 2.235-.61 1.61 0 2.656.97 1.063.953 1.14 2.53h-1.046q-.078-1.155-.844-1.859-.75-.718-1.906-.718-1.485 0-2.297 1.062-.813 1.063-.813 2.985v.328q0 1.89.813 2.953.812 1.047 2.297 1.047zm9.782.922q-1.25 0-2.265-.625-1.016-.625-1.594-1.72-.563-1.109-.563-2.484v-.39q0-1.422.547-2.563.563-1.14 1.547-1.781.985-.656 2.125-.656 1.797 0 2.844 1.219 1.062 1.218 1.062 3.343v.61h-7.03v.218q0 1.672.952 2.797.969 1.11 2.422 1.11.875 0 1.547-.313.672-.328 1.219-1.031l.687.516q-1.203 1.75-3.5 1.75zm-.203-9.297q-1.219 0-2.062.906-.844.89-1.032 2.422h5.922v-.125q-.047-1.422-.812-2.313-.766-.89-2.016-.89zm11.935 6.609q0-.812-.656-1.297-.657-.5-1.97-.781-1.312-.281-2.03-.64-.72-.36-1.079-.876-.343-.515-.343-1.25 0-1.172.968-1.922.985-.765 2.5-.765 1.657 0 2.641.812 1 .813 1 2.125h-1.094q0-.875-.718-1.437-.72-.578-1.829-.578-1.078 0-1.734.484-.64.469-.64 1.234 0 .735.53 1.141.548.406 1.985.75 1.438.328 2.14.719.72.375 1.063.922.36.53.36 1.297 0 1.25-1.016 2-1 .75-2.625.75-1.719 0-2.797-.829-1.062-.843-1.062-2.125h1.093q.063.97.797 1.5.75.532 1.969.532 1.14 0 1.844-.5.703-.5.703-1.266zm9.446 0q0-.812-.656-1.297-.656-.5-1.969-.781-1.312-.281-2.03-.64-.72-.36-1.079-.876-.344-.515-.344-1.25 0-1.172.969-1.922.984-.765 2.5-.765 1.656 0 2.64.812 1 .813 1 2.125h-1.093q0-.875-.719-1.437-.719-.578-1.828-.578-1.078 0-1.734.484-.641.469-.641 1.234 0 .735.531 1.141.547.406 1.985.75 1.437.328 2.14.719.719.375 1.063.922.36.53.36 1.297 0 1.25-1.016 2-1 .75-2.625.75-1.72 0-2.797-.829-1.063-.843-1.063-2.125h1.094q.062.97.797 1.5.75.532 1.969.532 1.14 0 1.843-.5.703-.5.703-1.266zm2.931-2.578q0-1.422.547-2.547.563-1.14 1.563-1.766 1.015-.64 2.281-.64 1.969 0 3.187 1.375 1.235 1.375 1.235 3.656v.234q0 1.422-.563 2.563-.547 1.14-1.547 1.766-1 .625-2.28.625-1.97 0-3.204-1.375-1.219-1.391-1.219-3.672v-.22zm1.094.312q0 1.766.922 2.907.922 1.125 2.406 1.125 1.469 0 2.375-1.125.922-1.141.922-3v-.22q0-1.124-.422-2.062-.406-.937-1.172-1.453-.75-.515-1.734-.515-1.453 0-2.375 1.14-.922 1.14-.922 3v.203zm14.511-4.156q-.344-.062-.734-.062-1.016 0-1.719.562-.703.563-1.016 1.656v6.766h-1.078v-9.86h1.063l.015 1.563q.875-1.734 2.782-1.734.453 0 .718.11l-.03 1z"
    />
    <path fill="none" d="m650.189 253.181 67.339-76.378"/>
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="m650.189 253.181 63.37-71.877"
    />
    <path
      fill="#000"
      stroke="#000"
      stroke-linecap="butt"
      d="m714.799 182.396 1.762-4.496-4.24 2.311z"
      fill-rule="evenodd"
    />
    <path fill="none" d="m647.67 444.118 54.71 72.063"/>
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="m647.67 444.118 51.081 67.284"
    />
    <path
      fill="#000"
      stroke="#000"
      stroke-linecap="butt"
      d="m697.436 512.4 4.06 2.616-1.429-4.613z"
      fill-rule="evenodd"
    />
    <path fill="none" d="m209.438 189.827 70.646 45.7"/>
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="m209.438 189.827 65.608 42.442"
    />
    <path
      fill="#000"
      stroke="#000"
      stroke-linecap="butt"
      d="m274.15 233.655 4.707 1.079-2.914-3.852z"
      fill-rule="evenodd"
    />
    <path
      fill="#cfe2f3"
      d="M78.226 189.827c0-36.234 29.373-65.607 65.606-65.607a65.606 65.606 0 0 1 65.606 65.607c0 36.233-29.373 65.606-65.606 65.606-36.233 0-65.606-29.373-65.606-65.606z"
      fill-rule="evenodd"
    />
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="M78.226 189.827c0-36.234 29.373-65.607 65.606-65.607a65.606 65.606 0 0 1 65.606 65.607c0 36.233-29.373 65.606-65.606 65.606-36.233 0-65.606-29.373-65.606-65.606z"
    />
    <path
      fill="#000"
      d="m115.117 193.169.407 2.062.5-1.969 2.89-9.78h1l2.844 9.78.5 1.985.437-2.078 2.391-9.688h1.156l-3.406 13.266h-1.078l-3-10.375-.344-1.313-.328 1.313-3.078 10.375h-1.078l-3.375-13.266h1.14l2.422 9.688zm17.552 3.765q-1.25 0-2.265-.625-1.016-.625-1.594-1.718-.563-1.11-.563-2.485v-.39q0-1.422.547-2.563.563-1.14 1.547-1.781.984-.656 2.125-.656 1.797 0 2.844 1.218 1.062 1.219 1.062 3.344v.61h-7.03v.218q0 1.672.952 2.797.969 1.11 2.422 1.11.875 0 1.547-.313.672-.328 1.219-1.031l.687.515q-1.203 1.75-3.5 1.75zm-.203-9.297q-1.219 0-2.062.907-.844.89-1.032 2.422h5.922v-.125q-.047-1.422-.812-2.313-.766-.89-2.016-.89zm13.966 4.282q0 2.312-1.031 3.672-1.016 1.343-2.735 1.343-2.062 0-3.109-1.531l-.047 1.344h-1.031v-14h1.094v5.578q1.03-1.61 3.078-1.61 1.75 0 2.765 1.329 1.016 1.328 1.016 3.718v.157zm-1.094-.188q0-1.953-.765-3.015-.75-1.063-2.125-1.063-1.047 0-1.782.516-.718.515-1.093 1.515v4.438q.812 1.86 2.89 1.86 1.344 0 2.11-1.063.765-1.063.765-3.188zm9.402 2.516q0-.813-.656-1.297-.656-.5-1.969-.781-1.312-.282-2.031-.641-.719-.36-1.078-.875-.344-.516-.344-1.25 0-1.172.969-1.922.984-.765 2.5-.765 1.656 0 2.64.812 1 .813 1 2.125h-1.093q0-.875-.72-1.437-.718-.579-1.827-.579-1.078 0-1.735.485-.64.469-.64 1.234 0 .735.531 1.14.547.407 1.984.75 1.438.329 2.141.72.719.375 1.062.921.36.532.36 1.297 0 1.25-1.016 2-1 .75-2.625.75-1.719 0-2.797-.828-1.062-.844-1.062-2.125h1.094q.062.969.796 1.5.75.531 1.97.531 1.14 0 1.843-.5.703-.5.703-1.265zm4.76 2.5h-1.095v-9.86h1.094v9.86zm-1.282-12.703q0-.313.203-.532.203-.218.547-.218.344 0 .547.218.203.22.203.532 0 .312-.203.515t-.547.203q-.344 0-.547-.203-.203-.203-.203-.515zm5.931.328v2.515h2.047v.891h-2.047v6.578q0 .813.297 1.219.297.39 1 .39.266 0 .875-.078l.047.891q-.422.156-1.172.156-1.11 0-1.625-.656-.516-.656-.516-1.922v-6.578h-1.812v-.89h1.812v-2.516h1.094zm8.12 12.562q-1.25 0-2.266-.625t-1.594-1.718q-.563-1.11-.563-2.485v-.39q0-1.422.547-2.563.563-1.14 1.547-1.781.984-.656 2.125-.656 1.797 0 2.844 1.218 1.062 1.219 1.062 3.344v.61h-7.03v.218q0 1.672.952 2.797.969 1.11 2.422 1.11.875 0 1.547-.313.672-.328 1.219-1.031l.687.515q-1.203 1.75-3.5 1.75zm-.204-9.297q-1.219 0-2.062.907-.844.89-1.032 2.422h5.922v-.125q-.047-1.422-.812-2.313-.766-.89-2.016-.89z"
    />
    <path
      fill="#cfe2f3"
      d="M63.102 516.181c0-36.233 29.373-65.606 65.607-65.606a65.606 65.606 0 0 1 65.606 65.606c0 36.234-29.373 65.606-65.606 65.606-36.234 0-65.607-29.373-65.607-65.606z"
      fill-rule="evenodd"
    />
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="M63.102 516.181c0-36.233 29.373-65.606 65.607-65.606a65.606 65.606 0 0 1 65.606 65.606c0 36.234-29.373 65.606-65.606 65.606-36.234 0-65.607-29.373-65.607-65.606z"
    />
    <path
      fill="#000"
      d="M121.388 519.382h-6.032l-1.359 3.72h-1.188l5.032-13.267h1.062l5.016 13.266h-1.156l-1.375-3.719zm-5.688-.953h5.328l-2.656-7.219-2.672 7.22zm17.839-.156q0 2.312-1.016 3.672-1.016 1.344-2.734 1.344-2.016 0-3.094-1.422v5.03H125.6v-13.655h1.016l.062 1.39q1.063-1.562 3.078-1.562 1.766 0 2.766 1.344 1.016 1.328 1.016 3.703v.156zm-1.094-.188q0-1.89-.781-2.984-.766-1.094-2.157-1.094-1 0-1.718.485-.72.484-1.094 1.406v4.719q.39.86 1.11 1.312.734.438 1.734.438 1.375 0 2.14-1.094.766-1.11.766-3.188zm11.433.188q0 2.312-1.016 3.672-1.015 1.344-2.734 1.344-2.016 0-3.094-1.422v5.03h-1.094v-13.655h1.016l.063 1.39q1.062-1.562 3.078-1.562 1.765 0 2.765 1.344 1.016 1.328 1.016 3.703v.156zm-1.094-.188q0-1.89-.781-2.984-.766-1.094-2.156-1.094-1 0-1.72.485-.718.484-1.093 1.406v4.719q.39.86 1.11 1.312.734.438 1.734.438 1.375 0 2.14-1.094.766-1.11.766-3.188z"
    />
    <path fill="none" d="m194.315 516.181 84.094-60.283"/>
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="m194.315 516.181 79.218-56.788"
    />
    <path
      fill="#000"
      stroke="#000"
      stroke-linecap="butt"
      d="m274.495 460.736 2.726-3.987-4.65 1.302z"
      fill-rule="evenodd"
    />
    <path
      fill="#cfe2f3"
      d="m25.047 346.113 68.22-67.7 68.22 67.7-68.22 67.7z"
      fill-rule="evenodd"
    />
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="m25.047 346.113 68.22-67.7 68.22 67.7-68.22 67.7z"
    />
    <path
      fill="#000"
      d="M78.829 340.72h-4.547v12.313h-1.11V340.72h-4.546v-.953h10.203v.953zm4.801 12.5q-1.25 0-2.266-.625-1.015-.625-1.593-1.718-.563-1.11-.563-2.485v-.39q0-1.422.547-2.563.563-1.14 1.547-1.781.984-.656 2.125-.656 1.797 0 2.844 1.218 1.062 1.22 1.062 3.344v.61h-7.031v.218q0 1.672.953 2.797.969 1.11 2.422 1.11.875 0 1.547-.313.672-.328 1.219-1.031l.687.515q-1.203 1.75-3.5 1.75zm-.203-9.297q-1.219 0-2.063.907-.843.89-1.03 2.422h5.921v-.125q-.047-1.422-.812-2.313-.766-.89-2.016-.89zm11.935 6.61q0-.813-.657-1.297-.656-.5-1.968-.781-1.313-.282-2.032-.64-.718-.36-1.078-.876-.343-.516-.343-1.25 0-1.172.968-1.922.985-.765 2.5-.765 1.657 0 2.64.812 1 .813 1 2.125H95.3q0-.875-.719-1.437-.718-.579-1.828-.579-1.078 0-1.734.485-.64.469-.64 1.234 0 .735.53 1.14.547.407 1.985.75 1.437.329 2.14.72.72.375 1.063.921.36.532.36 1.297 0 1.25-1.016 2-1 .75-2.625.75-1.719 0-2.797-.828-1.063-.844-1.063-2.125h1.094q.063.969.797 1.5.75.531 1.969.531 1.14 0 1.844-.5.703-.5.703-1.265zm5.227-9.875v2.515h2.047v.891h-2.047v6.578q0 .813.297 1.219.297.39 1 .39.266 0 .875-.078l.047.891q-.422.156-1.172.156-1.109 0-1.625-.656-.515-.656-.515-1.922v-6.578h-1.813v-.89h1.813v-2.516h1.093zm10.213 9.875q0-.813-.656-1.297-.656-.5-1.969-.781-1.312-.282-2.031-.64-.719-.36-1.078-.876-.344-.516-.344-1.25 0-1.172.969-1.922.984-.765 2.5-.765 1.656 0 2.64.812 1 .813 1 2.125h-1.093q0-.875-.719-1.437-.719-.579-1.828-.579-1.078 0-1.734.485-.641.469-.641 1.234 0 .735.531 1.14.547.407 1.985.75 1.437.329 2.14.72.719.375 1.063.921.359.532.359 1.297 0 1.25-1.016 2-1 .75-2.625.75-1.718 0-2.796-.828-1.063-.844-1.063-2.125h1.094q.062.969.797 1.5.75.531 1.968.531 1.141 0 1.844-.5.703-.5.703-1.265z"
    />
    <path fill="none" d="M161.488 346.113h62.047"/>
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="M161.488 346.113h56.047"
    />
    <path
      fill="#000"
      stroke="#000"
      stroke-linecap="butt"
      d="m217.535 347.765 4.538-1.652-4.538-1.652z"
      fill-rule="evenodd"
    />
    <path
      fill="#cfe2f3"
      d="M772.99 307.85h122.803v76.378H772.99z"
      fill-rule="evenodd"
    />
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="M772.99 307.85h122.803v76.378H772.99z"
    />
    <path
      fill="#000"
      d="M819.655 348.819q-.218 2.094-1.5 3.219-1.265 1.109-3.375 1.109-1.484 0-2.625-.734-1.125-.75-1.75-2.094-.609-1.36-.625-3.094v-1.719q0-1.781.625-3.14.625-1.36 1.782-2.11 1.156-.75 2.672-.75 2.14 0 3.375 1.157 1.234 1.156 1.421 3.187h-1.125q-.421-3.375-3.671-3.375-1.797 0-2.875 1.344-1.063 1.344-1.063 3.719v1.625q0 2.296 1.031 3.671 1.047 1.36 2.828 1.36 1.75 0 2.641-.844.906-.844 1.11-2.531h1.124zm8.694 4.14q-.156-.468-.203-1.375-.578.75-1.469 1.157-.89.406-1.875.406-1.422 0-2.312-.797-.875-.797-.875-2 0-1.437 1.203-2.281 1.203-.844 3.344-.844h1.968v-1.11q0-1.062-.656-1.671-.64-.61-1.89-.61-1.141 0-1.891.594-.75.578-.75 1.406l-1.094-.015q0-1.172 1.094-2.031 1.094-.86 2.687-.86 1.657 0 2.61.828.953.813.984 2.282v4.671q0 1.438.297 2.141v.11h-1.172zm-3.422-.78q1.094 0 1.953-.532.86-.531 1.25-1.406v-2.172h-1.953q-1.625.015-2.547.594-.921.578-.921 1.593 0 .828.609 1.375.625.547 1.61.547zm10.837.046q1.14 0 1.906-.64.782-.641.844-1.672h1.047q-.047.906-.578 1.656-.516.734-1.375 1.156-.86.422-1.844.422-1.937 0-3.078-1.344-1.125-1.36-1.125-3.64v-.329q0-1.453.5-2.562.516-1.125 1.469-1.734.953-.61 2.234-.61 1.61 0 2.656.969 1.063.953 1.141 2.531h-1.047q-.078-1.156-.844-1.86-.75-.718-1.906-.718-1.484 0-2.297 1.063-.812 1.062-.812 2.984v.328q0 1.89.812 2.953.813 1.047 2.297 1.047zm7.048-7.453q.547-.89 1.375-1.36.844-.484 1.844-.484 1.578 0 2.344.89.781.891.797 2.673v6.468h-1.094v-6.484q0-1.312-.563-1.953-.546-.656-1.75-.656-1.015 0-1.796.64-.782.625-1.157 1.703v6.75h-1.078v-14h1.078v5.813zm12.974 8.375q-1.25 0-2.266-.625t-1.594-1.719q-.562-1.11-.562-2.484v-.39q0-1.423.547-2.563.562-1.141 1.547-1.782.984-.656 2.125-.656 1.796 0 2.843 1.219 1.063 1.219 1.063 3.344v.609h-7.031v.219q0 1.672.953 2.797.968 1.109 2.422 1.109.875 0 1.546-.312.672-.329 1.22-1.032l.687.516q-1.203 1.75-3.5 1.75zm-.203-9.297q-1.22 0-2.063.906-.844.89-1.031 2.422h5.922v-.125q-.047-1.422-.813-2.312-.765-.891-2.015-.891z"
    />
    <path fill="none" d="m694.35 346.113 78.645-.063"/>
    <path
      stroke="#000"
      stroke-linejoin="round"
      stroke-linecap="butt"
      d="m694.35 346.113 72.645-.058"
    />
    <path
      fill="#000"
      stroke="#000"
      stroke-linecap="butt"
      d="m766.996 347.706 4.537-1.655-4.54-1.648z"
      fill-rule="evenodd"
    />
    <path fill="none" d="M92.1 22.816h103.464v53.166H92.1z"/>
    <path
      class="svg-label"
      fill="#000"
      d="M105.897 53.27v9.266h-1.922v-22.75h7.75q3.547 0 5.593 1.813 2.063 1.812 2.063 4.984 0 3.203-1.984 4.953-1.97 1.735-5.72 1.735h-5.78zm0-1.624h5.828q2.797 0 4.265-1.328 1.47-1.329 1.47-3.704 0-2.359-1.47-3.75-1.453-1.406-4.14-1.437h-5.953v10.219zm16.109 2.187q0-2.437.937-4.39.954-1.954 2.672-3.032 1.735-1.093 3.922-1.093 3.375 0 5.469 2.375 2.094 2.359 2.094 6.265v.39q0 2.454-.953 4.423-.938 1.953-2.657 3.015-1.718 1.063-3.922 1.063-3.359 0-5.468-2.36-2.094-2.375-2.094-6.28v-.376zm1.875.516q0 3.031 1.562 4.984 1.579 1.938 4.125 1.938 2.532 0 4.094-1.938 1.578-1.953 1.578-5.14v-.36q0-1.937-.718-3.547-.72-1.61-2.016-2.484-1.297-.89-2.969-.89-2.5 0-4.078 1.968-1.578 1.953-1.578 5.125v.344zm24.89-7.125q-.593-.11-1.265-.11-1.75 0-2.969.985-1.203.969-1.719 2.828v11.61h-1.859V45.63h1.828l.031 2.688q1.485-3 4.766-3 .781 0 1.234.203l-.046 1.703zm6.641-5.922v4.328h3.5v1.531h-3.5v11.266q0 1.406.5 2.094.516.687 1.703.687.47 0 1.516-.156l.078 1.531q-.734.266-2 .266-1.922 0-2.797-1.11-.875-1.125-.875-3.296V47.16h-3.11V45.63h3.11v-4.328h1.875zm17.5 16.937q0-1.39-1.125-2.234-1.11-.844-3.36-1.312-2.25-.485-3.5-1.094-1.234-.625-1.843-1.516-.594-.89-.594-2.156 0-2 1.672-3.297 1.672-1.312 4.281-1.312 2.829 0 4.532 1.406 1.718 1.39 1.718 3.64h-1.875q0-1.484-1.25-2.468-1.234-.985-3.125-.985-1.843 0-2.968.828-1.11.813-1.11 2.125 0 1.266.922 1.97.938.687 3.39 1.265 2.47.578 3.688 1.234 1.235.656 1.828 1.578.594.922.594 2.235 0 2.14-1.734 3.422-1.719 1.28-4.5 1.28-2.953 0-4.797-1.421-1.828-1.438-1.828-3.625h1.875q.11 1.64 1.375 2.562 1.281.907 3.375.907 1.953 0 3.156-.86t1.203-2.172z"
    />
    <path fill="none" d="M672.52 26.549h169.07v45.7H672.52z"/>
    <path
      class="svg-label"
      fill="#000"
      d="M696.676 59.894h-10.328l-2.344 6.375h-2.016l8.61-22.75h1.828l8.61 22.75h-2l-2.36-6.375zm-9.734-1.641h9.125l-4.563-12.39-4.562 12.39zm16.25-.594q0-3.937 1.75-6.265 1.765-2.344 4.78-2.344 3.423 0 5.22 2.703v-9.484h1.859v24h-1.75l-.078-2.25q-1.797 2.562-5.281 2.562-2.922 0-4.72-2.344-1.78-2.36-1.78-6.36v-.218zm1.89.328q0 3.235 1.297 5.11 1.297 1.86 3.656 1.86 3.453 0 4.907-3.048v-7.937q-1.454-3.297-4.875-3.297-2.36 0-3.672 1.86-1.313 1.843-1.313 5.452zm27.313 8.282q-.282-.797-.36-2.36-.984 1.281-2.515 1.985-1.516.687-3.219.687-2.438 0-3.953-1.36-1.5-1.359-1.5-3.437 0-2.469 2.047-3.906 2.062-1.438 5.734-1.438h3.39V54.52q0-1.813-1.124-2.844-1.11-1.047-3.25-1.047-1.953 0-3.235 1-1.28 1-1.28 2.406l-1.876-.015q0-2.016 1.875-3.485 1.875-1.484 4.61-1.484 2.828 0 4.453 1.422 1.64 1.406 1.687 3.937v8q0 2.453.516 3.672v.188h-2zm-5.875-1.344q1.875 0 3.343-.906 1.485-.907 2.157-2.422v-3.72h-3.344q-2.797.032-4.375 1.032-1.578.985-1.578 2.719 0 1.422 1.047 2.36 1.062.937 2.75.937zm25.937-6.938q0 3.953-1.75 6.282-1.75 2.312-4.687 2.312-3.469 0-5.313-2.437v8.625h-1.86V49.362h1.735l.094 2.39q1.828-2.702 5.297-2.702 3.031 0 4.75 2.297 1.734 2.297 1.734 6.375v.265zm-1.875-.328q0-3.234-1.328-5.11-1.328-1.874-3.703-1.874-1.719 0-2.953.828-1.235.828-1.89 2.406v8.11q.671 1.453 1.921 2.218 1.25.766 2.953.766 2.36 0 3.672-1.875 1.328-1.89 1.328-5.469zm8.922-12.625v4.328h3.5v1.532h-3.5v11.265q0 1.406.5 2.094.516.687 1.703.687.469 0 1.516-.156l.078 1.531q-.734.266-2 .266-1.922 0-2.797-1.11-.875-1.124-.875-3.296V50.894h-3.11v-1.532h3.11v-4.328h1.875zm13.922 21.547q-2.156 0-3.906-1.062-1.735-1.063-2.703-2.954-.97-1.906-.97-4.265v-.672q0-2.438.938-4.39.953-1.954 2.641-3.063 1.687-1.125 3.656-1.125 3.078 0 4.875 2.11 1.813 2.093 1.813 5.734v1.046h-12.063v.36q0 2.875 1.64 4.797 1.657 1.906 4.157 1.906 1.5 0 2.64-.547 1.157-.547 2.094-1.75l1.172.89q-2.062 2.985-5.984 2.985zm-.344-15.937q-2.11 0-3.562 1.546-1.438 1.547-1.75 4.157h10.14v-.203q-.078-2.438-1.39-3.97-1.313-1.53-3.438-1.53zm18.14.312q-.593-.11-1.265-.11-1.75 0-2.969.985-1.203.969-1.718 2.828v11.61h-1.86V49.362h1.828l.032 2.688q1.484-3 4.765-3 .782 0 1.235.203l-.047 1.703zm13.079 11.016q0-1.39-1.125-2.235-1.11-.843-3.36-1.312-2.25-.485-3.5-1.094-1.234-.625-1.843-1.516-.594-.89-.594-2.156 0-2 1.672-3.297 1.672-1.312 4.281-1.312 2.828 0 4.531 1.406 1.72 1.39 1.72 3.64h-1.876q0-1.484-1.25-2.468-1.234-.984-3.125-.984-1.844 0-2.969.828-1.109.812-1.109 2.125 0 1.265.922 1.968.937.688 3.39 1.266 2.47.578 3.688 1.234 1.234.657 1.828 1.579.594.921.594 2.234 0 2.14-1.734 3.422-1.72 1.281-4.5 1.281-2.954 0-4.797-1.422-1.828-1.437-1.828-3.625h1.875q.109 1.64 1.375 2.563 1.28.906 3.375.906 1.953 0 3.156-.86 1.203-.859 1.203-2.171z"
    />
  </g>
  <style>
    .svg-label {
      fill: var(--c-text);
    }
  </style>
</svg>

Hexagonal Architecture, also known by the name of “ports and adapters”, is a method of application design that ensures separation of concerns between different parts of your software. It works best for web applications but I’m sure you could adapt the same principles for any type of program.

At the core, the idea is that there are “ports”, or interfaces into your application, and “adapters” which interface between your code and any downstream dependencies. Some common ports would be things like a JSON API or web interface, or even the test runner! Adapters would be things like your database or cache, or any third-party APIs you are depending on. The actual bulk of your application is called the domain layer, and it’s where your business logic lives.

What does this look like in practice? To ensure the clean division of the different modules, the domain layer doesn’t import from any of the other parts of the application. Logically, this makes sense - your business shouldn’t depend on whether it’s being served as a web or mobile application, or whether you decide to use Postgres or MySQL. The clean separation helped redefine (for me) what “business logic” actually is: it’s the part of the application that dictates what your program should actually _do_. In the past, I’ve heard that term applied to pretty much any kind of backend code, but now when I look at the domain layer it reads more like something that I could show to a non-programmer and they would understand what’s going on.

### Pros and Cons of Hexagonal Architecture

There are many benefits to this approach, but one of the main ones is testability. Now, when you’re testing your API code (i.e. parsing requests and serializing responses), you won’t be hitting the database. This both ensures you’re testing what you actually mean to as well as speeds up your tests dramatically. When running a setup like this on a microservice in production, our entire test suite (a few hundred tests - it was a small service) ran in around 10-20ms. As the application grows, this benefit becomes huge! It’s now realistic to run your test suite every time you save, versus if your tests take a minute or more to run it just becomes another onerous step to complete before you open a pull request.

The main downside to hexagonal architecture is the amount of boilerplate code you end up writing, especially for simple programs. A basic CRUD endpoint goes from a single line of code to dozens of lines across 3 files and 4 separate tests (API layer, domain layer, database, and an integration test) that aren’t very meaningful as they’re effectively testing a single line of code that calls one of the other modules. If you’re building an MVP and time to market is the most important factor in the success of your business, then maybe this approach isn’t for you. However, I think there are some good takeaways regardless.

## Tech stack

For this example, I chose to use Flask and SqlAlchemy Core (just the DB API, not the ORM). I used Alembic for migrations and [`inject`](https://github.com/ivankorobkov/python-inject) (a lesser-known but great library!) for dependency injection. Because of the way the application is laid out, I didn't end up using any of the connector libraries (like `flask-sqlalchemy`) that help combine these libraries into a full-featured framework. But that's kinda the point of the whole exercise - maybe the part of your application that handles web requests **shouldn't** know the intimate details of where your data is being stored!

I also used the `typing` library available in Python 3.5+ (and earlier versions through type comments) as well as `mypy` for static type analysis. I leveraged dataclasses to model the data stored in the database. They replaced ORM objects in my application with the added benefit of removing easy access to the database.

## Challenges I faced

The main challenge I faced getting the project finished was working with the `typing` library. Python's type hinting system is still very new, and mypy is very slow and support for third-party libraries isn't really there yet.

In addition, it can be hard to find good guidance and documentation online for things like SqlAlchemy Core. Most people are using the ORM, so the vast majority of information that's available caters to questions about that. In general, taking an approach that isn't commonly adopted in the community can make it difficult to get help if you get stuck.

One criticism of this approach is that it might be seen as not Pythonic, but rather better fit for a language like Java or Go. That's probably true overall, but I think the issues given in the introduction deserve to be addressed regardless of programming language. The popularity of dynamically-typed languages like Python for writing backend code makes good conventions even more important, as the language itself provides less safety.

## Final thoughts and next steps

Even if you don't adopt this exact architecture for your next project, think hard about the separation of all the different functions of your application. It takes a li ttle bit more time and effort up front, but it more than pays off in the long run. It's a great feeling working on a codebase that's written in a way that's _easy_ to test. After experiencing real confidence that your changes are working as expected and not breaking any existing functionality, you'll never want to go back!

If you're interested in discussing Hexagonal Architecture, testing, or even Python in general, please leave a comment or shoot me an email!
